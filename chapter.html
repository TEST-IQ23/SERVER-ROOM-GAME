<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chapter</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="chapter-container" class="container">
    <h2 id="chapter-title">Chapter Loading...</h2>
    <p id="chapter-intro" class="intro-text"></p>
    <div id="questions"></div>
    <button id="submitBtn">Submit Answers</button>
    <p id="feedbackMsg" class="feedback"></p>
    <a id="nextChapterLink" class="hidden" href="#">Go to Next Chapter →</a>
  </div>

  <script src="chapters.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const chapterNum = parseInt(urlParams.get("chapter")) || 1;
    const chapterData = chapters[chapterNum - 1];

    const titleEl = document.getElementById("chapter-title");
    const introEl = document.getElementById("chapter-intro");
    const questionsEl = document.getElementById("questions");
    const submitBtn = document.getElementById("submitBtn");
    const feedbackEl = document.getElementById("feedbackMsg");
    const nextLink = document.getElementById("nextChapterLink");

    titleEl.textContent = `Chapter ${chapterNum}: ${chapterData.title}`;
    introEl.textContent = chapterData.intro;

    chapterData.questions.forEach((q, index) => {
      const wrapper = document.createElement("div");
      wrapper.className = "question-block";
      wrapper.innerHTML = `
        <p>${index + 1}. ${q.question}</p>
        ${q.options.map((opt, i) => `
          <label>
            <input type="radio" name="q${index}" value="${opt}">
            ${opt}
          </label><br>
        `).join("")}
      `;
      questionsEl.appendChild(wrapper);
    });

    submitBtn.onclick = () => {
      let correct = 0;
      chapterData.questions.forEach((q, index) => {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        if (selected && selected.value === q.answer) correct++;
      });

      const score = correct / chapterData.questions.length;
      if (score === 1) {
        feedbackEl.textContent = "✅ Excellent! Chapter completed.";
        nextLink.classList.remove("hidden");

        let unlocked = parseInt(localStorage.getItem("unlockedChapters")) || 1;
        if (chapterNum >= unlocked && chapterNum < 10) {
          localStorage.setItem("unlockedChapters", chapterNum + 1);
        }

        nextLink.href = `chapter.html?chapter=${chapterNum + 1}`;
      } else {
        feedbackEl.textContent = `❌ You got ${correct} of ${chapterData.questions.length} correct. Try again.`;
      }
    };
  </script>
</body>
</html>
