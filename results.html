<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Results - Server Room Lockdown</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container results-page">
    <h1>üéâ Mission Complete!</h1>
    <p><strong>Agent:</strong> <span id="playerName"></span></p>
    <p><strong>Chapter Completed:</strong> <span id="chapterTitle"></span></p>
    <p><strong>Time Taken:</strong> <span id="timeTaken"></span> seconds</p>
    <p><strong>Score:</strong> <span id="correctAnswers"></span> correct / <span id="wrongAnswers"></span> wrong</p>

    <div class="results-buttons">
      <button onclick="goToChapters()">üîÅ Play Another Chapter</button>
      <button onclick="downloadCertificate()">üìÑ Download Certificate</button>
      <a id="whatsappShare" href="#" target="_blank">
        <button>üì§ Share on WhatsApp</button>
      </a>
      <a href="https://forms.gle/YOUR_FEEDBACK_FORM" target="_blank">
        <button>üìù Submit Feedback</button>
      </a>
    </div>
  </div>

  <script>
    // ==== Load result data ====
    const playerName = localStorage.getItem('playerName') || 'Unknown Player';
    const chapterTitle = localStorage.getItem('lastChapter') || localStorage.getItem('selectedChapterTitle') || 'Unknown Chapter';
    const timeTaken = localStorage.getItem('timeTaken') || '0';
    const correct = localStorage.getItem('correctAnswers') || localStorage.getItem('correctCount') || '0';
    const wrong = localStorage.getItem('wrongAnswers') || localStorage.getItem('wrongCount') || '0';

    document.getElementById('playerName').textContent = playerName;
    document.getElementById('chapterTitle').textContent = chapterTitle;
    document.getElementById('timeTaken').textContent = timeTaken;
    document.getElementById('correctAnswers').textContent = correct;
    document.getElementById('wrongAnswers').textContent = wrong;

    // ==== WhatsApp Share ====
    const shareText = `üéÆ ${playerName} just completed "${chapterTitle}" in Server Room Lockdown!\n‚úÖ ${correct} correct | ‚ùå ${wrong} wrong | ‚è±Ô∏è ${timeTaken}s\nPlay now: [YOUR_GAME_LINK]`;
    document.getElementById('whatsappShare').href = `https://wa.me/?text=${encodeURIComponent(shareText)}`;

    // ==== Certificate Download ====
    function downloadCertificate() {
      const certWindow = window.open('', '_blank');
      certWindow.document.write(`
        <html>
          <head><title>Certificate</title></head>
          <body style="text-align:center; font-family:sans-serif;">
            <h1>üéì Certificate of Completion</h1>
            <p>This certifies that</p>
            <h2>${playerName}</h2>
            <p>successfully completed</p>
            <h3>${chapterTitle}</h3>
            <p>Score: ${correct}/10</p>
            <p>Time: ${timeTaken} seconds</p>
            <p>Date: ${new Date().toLocaleDateString()}</p>
          </body>
        </html>
      `);
      certWindow.print();
    }

    // ==== Return to Chapters ====
    function goToChapters() {
      window.location.href = "chapters.html";
    }

    // ==== Auto-submit to Google Form Leaderboard ====
    function submitToLeaderboard() {
      const formURL = 'https://docs.google.com/forms/d/e/YOUR_FORM_ID/formResponse';

      const formData = new FormData();
      formData.append('entry.YOUR_NAME_FIELD_ID', playerName);
      formData.append('entry.YOUR_CHAPTER_FIELD_ID', chapterTitle);
      formData.append('entry.YOUR_TIME_FIELD_ID', timeTaken);
      formData.append('entry.YOUR_SCORE_FIELD_ID', correct);
      formData.append('entry.YOUR_WRONG_FIELD_ID', wrong);

      fetch(formURL, {
        method: 'POST',
        mode: 'no-cors',
        body: formData
      });
    }

    // Auto-run leaderboard submission
    submitToLeaderboard();
  </script>
</body>
</html>
